var fs = require('fs');

servePage = function(webroot_path) {

  return function servePage(req, res, next) {

    // Pass to next Connect module if URL is not breed page
    if (req.url.length > 6) {
      if (req.url.toLowerCase().substring(0, 7) != '/breed/') {
        next();
        return;
      }
    }

    var breed_id = req.url.substring(7, req.url.length);
    console.log('Breed id is: ' + breed_id);

    var breedPage_filepath = webroot_path + '/breed/page_content.txt';

  	var page_content = '<!DOCTYPE html><html><head><title>Pampered Poultry - Upload your backyard chicken photos</title>';
  	page_content += '<link rel="shortcut icon" href="/images/favicon.ico">\n';
  	page_content += '<script type="text/javascript" src="/js/jquery-1.8.2.min.js" ></script>\n';

  	// Add dynamic page content here
  	page_content += '<script>\n';
  	page_content += '$(document).ready(function() {\n';
  	page_content += '   localStorage.setItem("upload_breed_id","' + breed_id +'");\n';
  	page_content += '});\n';
  	page_content += '</script>\n';

	if (fs.existsSync(breedPage_filepath)) {
	  try {
	    page_content += fs.readFileSync(breedPage_filepath);
	    
	  } catch(err) {
	    console.log('Error loading breed file content: ' + err.message);
	    // res end
	  }

	} else {
	    console.log('ERROR: content file not found');
	    // res end
	}

  	res.end(page_content);
  	return;
  }

}

/* Expose public functions ------ */
exports.servePage = servePage;